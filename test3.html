<!DOCTYPE html>
<html>
<head>
    <title>图书管理系统</title>
    <style>
        /* 拖动矩形样式 */
        #dragContainer {
            width: 600px;
            height: 400px;
            border: 2px solid #333;
            position: relative;
            margin: 20px;
        }
        
        #dragBox {
            width: 80px;
            height: 50px;
            background-color: red;
            position: absolute;
            top: 50px;
            left: 50px;
            cursor: move;
            user-select: none;
        }

        /* 表格样式 */
        .table-section {
            margin: 40px 20px;
            padding: 20px;
            border-top: 3px solid #4CAF50;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 15px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #4CAF50;
            color: white;
        }
        
        select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- 可拖动矩形 -->
    <h2>可拖动矩形</h2>
    <div id="dragContainer">
        <div id="dragBox"></div>
    </div>

    <!-- 图书管理系统 -->
    <div class="table-section">
        <h2>图书查询系统</h2>
        <select id="categoryFilter" onchange="filterBooks()">
            <option value="all">所有分类</option>
            <option value="children">儿童书籍</option>
            <option value="cooking">烹饪美食</option>
            <option value="web">网络技术</option>
        </select>

        <table id="bookTable">
            <thead>
                <tr>
                    <th>书名</th>
                    <th>作者</th>
                    <th>分类</th>
                    <th>语言</th>
                    <th>年份</th>
                    <th>价格</th>
                </tr>
            </thead>
            <tbody id="bookData"></tbody>
        </table>
    </div>

    <script>
        // 可拖动矩形功能
        (function() {
            const dragBox = document.getElementById('dragBox');
            let isDragging = false;
            let startX, startY, initialX, initialY;

            dragBox.addEventListener('mousedown', startDrag);

            function startDrag(e) {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialX = dragBox.offsetLeft;
                initialY = dragBox.offsetTop;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
            }

            function drag(e) {
                if (!isDragging) return;
                
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                let newX = initialX + dx;
                let newY = initialY + dy;
                
                // 边界限制
                newX = Math.max(0, Math.min(newX, 600 - dragBox.offsetWidth));
                newY = Math.max(0, Math.min(newY, 400 - dragBox.offsetHeight));
                
                dragBox.style.left = newX + 'px';
                dragBox.style.top = newY + 'px';
            }

            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
            }
        })();

        // 图书管理功能
        (function() {
            function loadXML() {
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "book.xml", true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        parseXML(xhr.responseXML);
                    }
                };
                xhr.send();
            }

            function parseXML(xml) {
                const books = xml.getElementsByTagName("book");
                const tbody = document.getElementById("bookData");
                
                for (let i = 0; i < books.length; i++) {
                    const book = books[i];
                    const row = document.createElement("tr");
                    
                    // 获取多个作者
                    const authors = Array.from(book.getElementsByTagName("author"))
                                      .map(a => a.textContent)
                                      .join(", ");

                    row.innerHTML = `
                        <td>${book.getElementsByTagName("title")[0].textContent}</td>
                        <td>${authors}</td>
                        <td>${book.getAttribute("category")}</td>
                        <td>${book.getElementsByTagName("title")[0].getAttribute("lang")}</td>
                        <td>${book.getElementsByTagName("year")[0].textContent}</td>
                        <td>$${book.getElementsByTagName("price")[0].textContent}</td>
                    `;
                    tbody.appendChild(row);
                }
            }

            window.filterBooks = function() {
                const filter = document.getElementById("categoryFilter").value;
                const rows = document.getElementById("bookData").rows;
                
                for (let row of rows) {
                    const category = row.cells[2].textContent;
                    row.style.display = 
                        (filter === "all" || category === filter) ? "" : "none";
                }
            }

            window.onload = loadXML;
        })();
    </script>
</body>
</html>